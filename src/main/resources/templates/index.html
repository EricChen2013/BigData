<!DOCTYPE html>
<html lang="zh" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml"
      xmlns:v-if="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>HDFS文件管理器</title>
    <script src="./js/vue.min.js"></script>
    <script src="./js/axios.min.js"></script>

    <style>
        .base {
            width: 50px;
            height: 50px;
        }

        .file {
            background-image: url(./image/file.png);
            background-size: cover;
        }

        .dir {
            background-image: url(./image/direcory.png);
            background-size: cover;
        }
    </style>
</head>
<body>
<div id="cur_working_path">
    <label>
        <input v-model.lazy="path" style="border-style: none;width: 700px">
    </label>
</div>
<div id="button">
    <input type="file" v-on:change="my_upload">
    <button v-on:click="my_makedir">新建文件夹</button>
    <button v-on:click="my_download">下载</button>
    <button v-on:click="my_delete">删除</button>
    <button v-on:click="my_analysis">分析</button>
</div>
<div id="views">
    <ul v-if="showing_dir">
        <li v-for="a_view in dir_filename_list">
            <div>
                <label><input type="checkbox"></label>
                <div class="base" v-on:dblclick="cur_working_path.path=a_view.path"
                     v-bind:class="testObject(a_view.dir_or_file)" title="{{a_view.path}}"></div>
                <p>{{a_view.path}}</p>
            </div>
        </li>
    </ul>
    <p v-else>{{file_content}}</p>
</div>

<script>
    var cur_working_path = new Vue({
        el: '#cur_working_path',
        data: {
            path: '/'
        }
    });
    var my_button = new Vue({
        el: '#button',
        methods: {
            my_upload: function (event) {
                var reader = new FileReader();
                reader.readAsText(event.target.files[0]);
                reader.onload = function (ev) {
                    axios.post('http://localhost:8080/upload', {
                        'filepath': cur_working_path.path + event.target.files[0].name,
                        'content': this.result
                    }).then(function (response) {
                        get_json_from_hdfs(cur_working_path.path);
                        alert(response.data);
                    }).catch(function (reason) {
                        alert('文件上传失败')
                    })
                }
            },
            my_makedir: function (event) {

            },
            my_download: function (event) {
                alert('download')
            },
            my_delete: function (event) {
                alert('delete')
            },
            my_analysis: function (event) {
                alert('analysis')
            }
        }
    });
    var my_views = new Vue({
        el: '#views',
        data: {
            dir_filename_list: null,
            showing_dir: true,
            file_content: null
        },
        methods: {
            testObject: function (e) {
                if (e === 'file')
                    return {file: true};
                else return {dir: true};
            }
        }
    });

    cur_working_path.$watch('path', function () {
        get_json_from_hdfs(cur_working_path.path);
    });

    function get_json_from_hdfs(path) {
        axios.get('http://localhost:8080/fs?path=' + path)
            .then(function (response) {
                console.log(response.data);
                if (response.status !== 200 || response.data.status === 'wrong') {
                    my_views.showing_dir = false;
                    my_views.file_content = '出错  ' + response.data.content;
                } else if (response.data.status === 'dir') {
                    if (response.content === '') {
                        my_views.showing_dir = false;
                        my_views.file_content = '这里没有东西';
                    } else {
                        my_views.showing_dir = true;
                        my_views.dir_filename_list = response.data.content;
                    }
                } else {
                    my_views.showing_dir = false;
                    my_views.file_content = response.data.content;
                }
            })
    }

    // 默认会加载 / 根目录
    get_json_from_hdfs('/');

    // 按钮们的监听和处理
</script>
</body>
</html>